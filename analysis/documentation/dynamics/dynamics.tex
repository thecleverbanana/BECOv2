\documentclass[10pt]{article}

% --- Encoding & Language ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

% --- Math Packages ---
\usepackage{amsmath, amssymb, amsfonts}
\usepackage{mathtools}
\usepackage{physics}
\usepackage{bm}
\usepackage{siunitx}

% --- Page Layout ---
\usepackage[margin=0.8in]{geometry}
\usepackage{setspace}
\singlespacing

% --- Theorem Environment ---
\usepackage{amsthm}
\newtheorem{statement}{Statement}[section]
\newtheorem{theorem}[statement]{Theorem}
\newtheorem{assumption}[statement]{Assumption}
\newtheorem{diagram}[statement]{Diagram}
\newtheorem{note}[statement]{Note}

% --- Figure & Table ---
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{hyperref}

% --- TikZ for Diagrams ---
\usepackage{tikz}
\usetikzlibrary{arrows.meta, decorations.pathmorphing, patterns}

% --- Code Listings ---
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily\footnotesize,
  frame=single,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
}

% --- Title Info ---
\title{\textbf{Dynamics}}
\author{Jerry Wu}
\date{\today}

\begin{document}

\maketitle

\noindent
Generalized coordinate: \(p_A^x, l_1, l_2, l_3\)

\vspace{0.5em}

Terrain function: \(h(x)\)

\vspace{1em}

\[
p_B^x \text{ solved from: } (p_B^x - p_A^x)^2 + (h(p_B^x) - h(p_A^x))^2 = \frac{l_2^4}{l_2^2 + (l_3^2 - l_1^2)^2}
\]

\[
\frac{\partial p_B^{x}}{\partial p_A^{x}}
=
\frac{(p_B^{x}-p_A^{x}) \;+\;
      \bigl[h(p_B^{x})-h(p_A^{x})\bigr]\,h'(p_A^{x})}
     {(p_B^{x}-p_A^{x}) \;+\;
      \bigl[h(p_B^{x})-h(p_A^{x})\bigr]\,h'(p_B^{x})}
\]

\[
\begin{aligned}
\frac{\partial p_B^{x}}{\partial l_1}
   &= \frac{
        2\,l_1\bigl(l_3^{2}-l_1^{2}\bigr)\,l_2^{4}
      }{
        \bigl[l_2^{2}+\bigl(l_3^{2}-l_1^{2}\bigr)^{2}\bigr]^{2}\,
        \big(
          \bigl(p_B^{x}-p_A^{x}\bigr)
          +\bigl[\,h(p_B^{x})-h(p_A^{x})\bigr]\,
          h'(p_B^{x})
        \big)
      },
\\[10pt]
\frac{\partial p_B^{x}}{\partial l_2}
   &= \frac{
        2\,l_2^{3}\bigl[l_2^{2}+\bigl(l_3^{2}-l_1^{2}\bigr)^{2}\bigr]
        -1\,l_2^{5}
      }{
        \bigl[l_2^{2}+\bigl(l_3^{2}-l_1^{2}\bigr)^{2}\bigr]^{2}\,
        \big(
          \bigl(p_B^{x}-p_A^{x}\bigr)
          +\bigl[\,h(p_B^{x})-h(p_A^{x})\bigr]\,
          h'(p_B^{x})
        \big)
      },
\\[10pt]
\frac{\partial p_B^{x}}{\partial l_3}
   &= \frac{
        2\,l_3\bigl(l_3^{2}-l_1^{2}\bigr)\,l_2^{4}
      }{
        \bigl[l_2^{2}+\bigl(l_3^{2}-l_1^{2}\bigr)^{2}\bigr]^{2}\,
        \big(
          \bigl(p_B^{x}-p_A^{x}\bigr)
          +\bigl[\,h(p_B^{x})-h(p_A^{x})\bigr]\,
          h'(p_B^{x})
        \big)
      }.
\end{aligned}
\]


\vspace{1em}

\(\beta \text{ solved from: } \)

\[
\omega = \beta = \arcsin\left( \frac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)
\]

\vspace{1em}

\[
\dot{\beta} = \frac{
\dot{p}_B^x - \dot{p}_A^x + \cos\beta (\dot{l}_3 - \dot{l}_1) - \dot{l}_2 \sin\beta
}{
l_2 \cos\beta + \sin\beta (l_3 - l_1)
}
\]

\vspace{1em}

\[\ddot{\omega}  = \ddot{\beta} =
\frac{
\dot{N}D
-
N\dot{D}
}{D^{2}}
\]
\begin{align}
N &\;=\;
    \dot{p}_B^{x}-\dot{p}_A^{x}
    +\cos\beta\bigl(\dot{l}_{3}-\dot{l}_{1}\bigr)
    -\dot{l}_{2}\sin\beta,
\\[4pt]
D &\;=\;
    l_{2}\cos\beta
    +\sin\beta\bigl(l_{3}-l_{1}\bigr),
\\[4pt]
\dot{N} &\;=\;
    \ddot{p}_B^{x}-\ddot{p}_A^{x}
    -\sin\beta\,\dot{\beta}\bigl(\dot{l}_{3}-\dot{l}_{1}\bigr)
    +\cos\beta\bigl(\ddot{l}_{3}-\ddot{l}_{1}\bigr)
    -\ddot{l}_{2}\sin\beta
    -\dot{l}_{2}\cos\beta\,\dot{\beta},
\\[4pt]
\dot{D} &\;=\;
    \dot{l}_{2}\cos\beta
    -l_{2}\sin\beta\,\dot{\beta}
    +\cos\beta\,\dot{\beta}\bigl(l_{3}-l_{1}\bigr)
    +\sin\beta\bigl(\dot{l}_{3}-\dot{l}_{1}\bigr).
\end{align}

\vspace{1em}

\[
\mathbf{r}_{\mathrm{com}} =
\begin{bmatrix}
p_A^x \\
h(p_A^x)
\end{bmatrix}
+
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
\]

\begin{align*}
\dot{\mathbf{r}}_{\text{com}} =\ &
\begin{bmatrix}
\dot{p}_A^x \\
h'(p_A^x) \cdot \dot{p}_A^x
\end{bmatrix}
+
\dot{l}_1
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
+
l_1 \dot{\beta}
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix} \\
&+
\frac{1}{2} \dot{l}_2
\begin{bmatrix}
\sin\beta \\
-\cos\beta
\end{bmatrix}
+
\frac{1}{2} l_2 \dot{\beta}
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
\end{align*}

\begin{align*}
\ddot{\mathbf{r}}_{\text{com}} =\ &
\begin{bmatrix}
\ddot{p}_A^x \\
h''(p_A^x)(\dot{p}_A^x)^2 + h'(p_A^x) \cdot \ddot{p}_A^x
\end{bmatrix} \\
&+
\ddot{l}_1
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
+
2 \dot{l}_1 \dot{\beta}
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix} \\
&+
l_1 \ddot{\beta}
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix}
+
l_1 (\dot{\beta})^2
\begin{bmatrix}
-\cos\beta \\
-\sin\beta
\end{bmatrix} \\
&+
\frac{1}{2} \ddot{l}_2
\begin{bmatrix}
\sin\beta \\
-\cos\beta
\end{bmatrix}
+
\dot{l}_2 \dot{\beta}
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix} \\
&+
\frac{1}{2} l_2 \ddot{\beta}
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
+
\frac{1}{2} l_2 (\dot{\beta})^2
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix}
\end{align*}

\textbf{Projection Vector: }
\begin{align*}
\frac{\partial \beta}{\partial p_A^x}
= \frac{ \dfrac{1}{l_2} \left( \dfrac{\partial p_B^x}{\partial p_A^x} - 1 \right) }
{ \sqrt{1 - \left( \dfrac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2 }
+ \dfrac{\sin(\beta)(l_3 - l_1)}{l_2} }
\end{align*}

\begin{align*}
\frac{\partial \beta}{\partial l_1}
= \frac{ \dfrac{1}{l_2} \left( \dfrac{\partial p_B^x}{\partial l_1} - \cos(\beta) \right) }
{ \sqrt{1 - \left( \dfrac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2 } 
+ \dfrac{\sin(\beta)(l_3 - l_1)}{l_2} }
\end{align*}


\begin{align*}
\frac{\partial \beta}{\partial l_2}
=
\frac{
\dfrac{1}{l_2} \cdot \dfrac{\partial p_B^x}{\partial l_2}
- \dfrac{1}{l_2^2}(p_B^x - p_A^x + \cos(\beta)(l_3 - l_1))
}{
\sqrt{1 - \left( \dfrac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2 }
+ \dfrac{\sin(\beta)(l_3 - l_1)}{l_2}
}
\end{align*}

\begin{align*}
\frac{\partial \beta}{\partial l_3}
= \frac{ \dfrac{1}{l_2} \left( \dfrac{\partial p_B^x}{\partial l_3} + \cos(\beta) \right) }
{ \sqrt{1 - \left( \dfrac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2 } 
+ \dfrac{\sin(\beta)(l_3 - l_1)}{l_2} }
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial p_A^x} &= 
\begin{bmatrix}
1 \\
h'(p_A^x)
\end{bmatrix}
+
l_1 \frac{d\beta}{dp_A^x}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \frac{d\beta}{dp_A^x}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial l_1} =
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
+
l_1 \frac{d\beta}{d l_1}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \frac{d\beta}{d l_1}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial l_2} =
\frac{1}{2}
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \frac{d\beta}{d l_2}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
+
l_1\frac{d\beta}{d l_2}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial l_3} =
l_1 \cdot \frac{\partial \beta}{\partial l_3}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \cdot \frac{\partial \beta}{\partial l_3}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
\end{align*}

\textbf{d'lambere formula: }
\[
\sum_i (F_g - m \mathbf{\ddot{r}_{com}})\delta_i 
+ \sum_i (\tau_{fA} + \tau_{fB} + \tau_{A1} + \tau_{A2} + \tau_{B1} + \tau_{B2} 
- I \mathbf{\ddot{\omega}})\delta_i = 0
\]

for torque, we have:
\[
\mathbf{r_{A}} = 
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
\]

\[
\mathbf{r_{B}} = 
\begin{bmatrix}
p_B^x \\
h(p_B^x)
\end{bmatrix}
-
\begin{bmatrix}
p_A^x \\
h(p_A^x)
\end{bmatrix}
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
\]

And:
\[
F_g = 
\begin{bmatrix}
0 \\
mg
\end{bmatrix}
\]

\[
\tau_{fA} = 
(
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
) 
\cross
f_A
\begin{bmatrix}
  1 \\
  h'(x_P^x)
\end{bmatrix}
\]

\[
\tau_{A1} = 
(
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
) 
\cross
\lambda_1
\begin{bmatrix}
  \cos(\beta) \\
  \sin(\beta)
\end{bmatrix}
=
-\frac{1}{2}\lambda_1 l_2
\]

\[
\tau_{A2} = 
(
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
) 
\cross
\lambda_2
\begin{bmatrix}
  \sin(\beta) \\
  - \cos(\beta)
\end{bmatrix}
=
\lambda_2l_1 
\]

\[
\tau_{fB} = 
(
\begin{bmatrix}
p_B^x \\
h(p_B^x)
\end{bmatrix}
-
\begin{bmatrix}
p_A^x \\
h(p_A^x)
\end{bmatrix}
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
) 
\cross
f_A
\begin{bmatrix}
  1 \\
  h'(x_P^x)
\end{bmatrix}
\]

\[
\tau_{B1} = 
(
\begin{bmatrix}
p_B^x \\
h(p_B^x)
\end{bmatrix}
-
\begin{bmatrix}
p_A^x \\
h(p_A^x)
\end{bmatrix}
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
) 
\cross
\lambda_1
\begin{bmatrix}
  \cos(\beta) \\
  \sin(\beta)
\end{bmatrix}
=
\frac{1}{2}\lambda_1 l_2
\]

\[
\tau_{B2} = 
(
\begin{bmatrix}
p_B^x \\
h(p_B^x)
\end{bmatrix}
-
\begin{bmatrix}
p_A^x \\
h(p_A^x)
\end{bmatrix}
-
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
-
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
) 
\cross
\lambda_2
\begin{bmatrix}
  \sin(\beta) \\
  - \cos(\beta)
\end{bmatrix}
=
\lambda_2l_3 
\]

\end{document}
