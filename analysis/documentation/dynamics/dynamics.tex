\documentclass[10pt]{article}

% --- Encoding & Language ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

% --- Math Packages ---
\usepackage{amsmath, amssymb, amsfonts}
\usepackage{mathtools}
\usepackage{physics}
\usepackage{bm}
\usepackage{siunitx}

% --- Page Layout ---
\usepackage[margin=0.8in]{geometry}
\usepackage{setspace}
\singlespacing

% --- Theorem Environment ---
\usepackage{amsthm}
\newtheorem{statement}{Statement}[section]
\newtheorem{theorem}[statement]{Theorem}
\newtheorem{assumption}[statement]{Assumption}
\newtheorem{diagram}[statement]{Diagram}
\newtheorem{note}[statement]{Note}

% --- Figure & Table ---
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{hyperref}

% --- TikZ for Diagrams ---
\usepackage{tikz}
\usetikzlibrary{arrows.meta, decorations.pathmorphing, patterns}

% --- Code Listings ---
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily\footnotesize,
  frame=single,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
}

% --- Title Info ---
\title{\textbf{Dynamics}}
\author{Jerry Wu}
\date{\today}

\begin{document}

\maketitle

\noindent
Generalized coordinate: \(p_A^x, l_1, l_2, l_3\)

\vspace{0.5em}

Terrain function: \(h(x)\)

\vspace{1em}

\[
p_B^x \text{ solved from: } (p_B^x - p_A^x)^2 + (h(p_B^x) - h(p_A^x))^2 = \frac{l_2^4}{l_2^2 + (l_3^2 - l_1^2)^2}
\]

\vspace{1em}

\(\beta \text{ solved from: } \)

\[
\omega = \beta = \arcsin\left( \frac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)
\]

\vspace{1em}

\[
\dot{\omega} = \dot{\beta} =
\frac{%
\begin{aligned}
 &l_{1}\cos\beta\,\dot l_{2}
 - l_{2}\cos\beta\,\dot l_{1}
 + l_{2}\cos\beta\,\dot l_{3} \\[2pt]
 &- l_{2}\dot p_{A_x}
 + l_{2}\dot p_{B_x}
 - l_{3}\cos\beta\,\dot l_{2} \\[2pt]
 &+ p_{A_x}\dot l_{2}
 - p_{B_x}\dot l_{2}
\end{aligned}}%
{\Bigl(
  \sqrt{\dfrac{-
    \bigl(l_{1}\cos\beta - l_{3}\cos\beta + p_{A_x} - p_{B_x}\bigr)^{2}
    + l_{2}^{2}}{\,l_{2}^{2}}}\,l_{2}
  - l_{1}\sin\beta
  + l_{3}\sin\beta
  \Bigr)\,l_{2}}
\]

\vspace{1em}

\[\ddot{\omega}  = \ddot{\beta} =
\begin{aligned}
&\frac{
\begin{aligned}
-(l_1 \cos\beta \, \dot{l}_2 - l_2 \cos\beta \, \dot{l}_1 + l_2 \cos\beta \, \dot{l}_3 \\
- l_2 \dot{pA_x} + l_2 \dot{pB_x} - l_3 \cos\beta \, \dot{l}_2 + pA_x \dot{l}_2 - pB_x \dot{l}_2) \dot{l}_2
\end{aligned}
}
{\left(\sqrt{\frac{-(l_1 \cos\beta - l_3 \cos\beta + pA_x - pB_x)^2 + l_2^2}{l_2^2}} \cdot l_2 - l_1 \sin\beta + l_3 \sin\beta\right) l_2^2} \\
\\
&+ 
\vspace{10pt}
\frac{
\begin{aligned}
&-l_1 \sin\beta \, \dot{\beta} \, \dot{l}_2 + l_1 \cos\beta \, \ddot{l}_2 + l_2 \sin\beta \, \dot{\beta} \, \dot{l}_1\\
&- l_2 \sin\beta \, \dot{\beta} \, \dot{l}_3 - l_2 \cos\beta \, \ddot{l}_1 + l_2 \cos\beta \, \ddot{l}_3\\
&- l_2 \ddot{pA_x} + l_2 \ddot{pB_x} + l_3 \sin\beta \, \dot{\beta} \, \dot{l}_2 - l_3 \cos\beta \, \ddot{l}_2
+ pA_x \ddot{l}_2 - pB_x \ddot{l}_2
\end{aligned}
}{
\left(\sqrt{\frac{-(l_1 \cos\beta - l_3 \cos\beta + pA_x - pB_x)^2 + l_2^2}{l_2^2}} \cdot l_2 - l_1 \sin\beta + l_3 \sin\beta\right) l_2
} \\
&+ \text{(third term omitted for brevity)}
\end{aligned}
\]

\vspace{1em}

\[
\mathbf{r}_{\mathrm{com}} =
\begin{bmatrix}
p_A^x \\
h(p_A^x)
\end{bmatrix}
+
l_1
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
\]

\begin{align*}
\dot{\mathbf{r}}_{\text{com}} =\ &
\begin{bmatrix}
\dot{p}_A^x \\
h'(p_A^x) \cdot \dot{p}_A^x
\end{bmatrix}
+
\dot{l}_1
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
+
l_1 \dot{\beta}
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix} \\
&+
\frac{1}{2} \dot{l}_2
\begin{bmatrix}
\sin\beta \\
-\cos\beta
\end{bmatrix}
+
\frac{1}{2} l_2 \dot{\beta}
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
\end{align*}

\begin{align*}
\ddot{\mathbf{r}}_{\text{com}} =\ &
\begin{bmatrix}
\ddot{p}_A^x \\
h''(p_A^x)(\dot{p}_A^x)^2 + h'(p_A^x) \cdot \ddot{p}_A^x
\end{bmatrix} \\
&+
\ddot{l}_1
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
+
2 \dot{l}_1 \dot{\beta}
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix} \\
&+
l_1 \ddot{\beta}
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix}
+
l_1 (\dot{\beta})^2
\begin{bmatrix}
-\cos\beta \\
-\sin\beta
\end{bmatrix} \\
&+
\frac{1}{2} \ddot{l}_2
\begin{bmatrix}
\sin\beta \\
-\cos\beta
\end{bmatrix}
+
\dot{l}_2 \dot{\beta}
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix} \\
&+
\frac{1}{2} l_2 \ddot{\beta}
\begin{bmatrix}
\cos\beta \\
\sin\beta
\end{bmatrix}
+
\frac{1}{2} l_2 (\dot{\beta})^2
\begin{bmatrix}
-\sin\beta \\
\cos\beta
\end{bmatrix}
\end{align*}

\textbf{Projection Vector: }
\begin{align*}
\frac{\partial \beta}{\partial p_A^x} = 
\frac{1}{\sqrt{1 - \left( \frac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2}} 
\cdot 
\frac{1}{l_2}
\cdot 
\left( 
    \frac{\partial P_B^x}{\partial P_A^x}
    - 1
    -\sin(\beta)(l_3-l_1)\cdot \frac{\partial \beta}{\partial P_A^x}
\right)
\end{align*}

\begin{align*}
\frac{\partial \beta}{\partial l_1} = 
\frac{1}{\sqrt{1 - \left( \frac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2}} 
\cdot 
\frac{1}{l_2}
\cdot 
\left( 
  \frac{\partial P_B^x}{\partial l_1}
  - \sin(\beta)(l_3 - l_1) \cdot \frac{\partial \beta}{\partial l_1}
  - \cos(\beta)
\right)
\end{align*}

\begin{align*}
\frac{\partial \beta}{\partial l_2} = 
\frac{1}{\sqrt{1 - \left( \frac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2}} 
\cdot 
(
-\frac{1}{l_2^2}
\left( 
P_B^x - P_A^x + \cos(\beta)(l_3-l_1)
\right)
+
\frac{1}{l_2}
\left( 
  \frac{\partial P_B^x}{\partial l_2}
  - \sin(\beta)(l_3 - l_1) \cdot \frac{\partial \beta}{\partial l_2}
\right)
)
\end{align*}

\begin{align*}
\frac{\partial \beta}{\partial l_3} = 
\frac{1}{\sqrt{1 - \left( \frac{(p_B^x + \cos(\beta) l_3) - (p_A^x + \cos(\beta) l_1)}{l_2} \right)^2}} 
\cdot 
\frac{1}{l_2}
\cdot 
\left( 
  \frac{\partial P_B^x}{\partial l_3}
  - \sin(\beta)(l_3 - l_1) \cdot \frac{\partial \beta}{\partial l_3}
  + \cos(\beta)
\right)
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial p_A^x} &= 
\begin{bmatrix}
1 \\
h'(p_A^x)
\end{bmatrix}
+
l_1 \frac{d\beta}{dp_A^x}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \frac{d\beta}{dp_A^x}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial l_1} =
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
+
l_1 \frac{d\beta}{d l_1}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \frac{d\beta}{d l_1}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial l_2} =
\frac{1}{2}
\begin{bmatrix}
\sin(\beta) \\
-\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \frac{d\beta}{d l_2}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
+
l_1\frac{d\beta}{d l_2}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
\end{align*}

\begin{align*}
\frac{\partial \mathbf{r}_{\mathrm{com}}}{\partial l_3} =
l_1 \cdot \frac{\partial \beta}{\partial l_3}
\begin{bmatrix}
- \sin(\beta) \\
\cos(\beta)
\end{bmatrix}
+
\frac{1}{2} l_2 \cdot \frac{\partial \beta}{\partial l_3}
\begin{bmatrix}
\cos(\beta) \\
\sin(\beta)
\end{bmatrix}
\end{align*}

\textbf{d'lambere formula: }
\[
\sum_i (F_g - m \mathbf{\ddot{r}_{com}})\delta_i 
+ \sum_i (\tau_{fA} + \tau_{fB} + \tau_{A1} + \tau_{A2} + \tau_{B1} + \tau_{B2} 
- I \mathbf{\ddot{\omega}})\delta_i = 0
\]


\end{document}
